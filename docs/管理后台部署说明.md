# 管理后台部署说明（Phase 1）

与《实施计划》Phase 1 管理后台对应，不修改计划文档，仅作操作说明。

## 1. 数据库迁移

在 **backend** 目录、且 MySQL 已启动并配置好 `.env` 中 `DATABASE_URL` 后执行：

```bash
cd backend
python3 -m alembic upgrade head
```

- 会执行 `001_create_users_payday_salary_tables.py`、`002_add_admin_users.py`，创建 `admin_users` 等表。

## 2. 首次管理员账号

迁移完成后，需至少创建一个管理员账号才能登录管理端。

**方式一：运行脚本（推荐）**

```bash
cd backend
python3 scripts/create_first_admin.py
```

- 若尚未存在用户名为 `admin` 的管理员，会创建一条：**用户名 `admin`，密码 `changeme`**。  
- 首次登录后请在管理端或数据库中修改密码。

**方式二：自行插入**

- 使用 `app.core.security.hash_password("你的密码")` 得到哈希后，向 `admin_users` 表插入一条记录（`username`、`password_hash` 等），与 `app.models.admin.AdminUser` 字段一致即可。

## 3. 管理端接口前缀

- 基础路径：`/api/v1/admin`
- 登录：`POST /api/v1/admin/auth/login`（body: `username`, `password`）  
- 其余接口需在 Header 中带 `Authorization: Bearer <token>`（JWT 的 payload 含 `scope=admin`）。

---

以上为 Phase 1 管理后台的部署与首次管理员创建说明；《实施计划》与迭代规划不做变更。
