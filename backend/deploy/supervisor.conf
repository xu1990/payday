; Supervisor 配置 - Celery Worker 和 Beat
; 用于生产环境管理异步任务队列
;
; 使用方法:
; 1. 安装 supervisor: pip install supervisor
; 2. 生成配置: echo_supervisord_conf > /etc/supervisord.conf
; 3. 将此文件内容追加到 /etc/supisord.conf 或放在 /etc/supervisor/conf.d/
; 4. 启动: supervisord -c /etc/supervisord.conf
; 5. 管理命令: supervisorctl status/start/stop/restart payday-worker/payday-beat

[program:payday-worker]
; Celery Worker - 处理异步任务
command=/path/to/venv/bin/celery -A app.celery_app worker --loglevel=info --concurrency=4
directory=/path/to/payday/backend
user=www-data
numprocs=1
autostart=true
autorestart=true
startsecs=10
stopwaitsecs=600
stopasgroup=true
killasgroup=true
redirect_stderr=true
stdout_logfile=/var/log/supervisor/payday-worker.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=10
environment=PYTHONUNBUFFERED="1",PATH="/path/to/venv/bin"

[program:payday-beat]
; Celery Beat - 定时任务调度
command=/path/to/venv/bin/celery -A app.celery_app beat --loglevel=info
directory=/path/to/payday/backend
user=www-data
numprocs=1
autostart=true
autorestart=true
startsecs=10
stopwaitsecs=60
redirect_stderr=true
stdout_logfile=/var/log/supervisor/payday-beat.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=10
environment=PYTHONUNBUFFERED="1",PATH="/path/to/venv/bin"

[group:payday-celery]
programs=payday-worker,payday-beat
priority=999
